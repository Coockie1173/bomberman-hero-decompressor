<html>
<body>
<h1>RND (.rnd) Model Viewer v1.0</h1>
<span>RND file:</span>
<input type="file" id="inputRND" accept=".rnd"/>
<span id="otherFileInputs">
</span>
<div id="output"></div>
<script src="three.min.js"></script>
<script src="n64texture.js" type="text/javascript"></script>
<script src="SHPN.js" type="text/javascript"></script>
<script src="RND.js" type="text/javascript"></script>
<script src="renderer.js" type="text/javascript"></script>
<script type="text/javascript">
var rnd_data = null
var created_3d_window = false

function addFileInput(id, text, accept, onchange) {
    var otherInputs = document.getElementById('otherFileInputs');
    otherInputs.appendChild(document.createElement('br'));
    var span = document.createElement('span');
    span.innerText = text;
    otherInputs.appendChild(span);
    var input = document.createElement('input');
    input.type = 'file';
    input.id = id;
    input.accept = accept;
    input.onchange = onchange;
    otherInputs.appendChild(input);
}

function clearFileInputs() {
    document.getElementById('otherFileInputs').innerHTML = '';
}

function updateInfo() {
    clearFileInputs();
    if(!created_3d_window){
        create_3d_window();
        created_3d_window = true;
    }
    load_new_3d_object(rnd_data);
    if(rnd_data.materials.length > 1) {
        if(!(rnd_data.materials.length == 1 && rnd_data.materials[0].name == "Dummy")) {
            addFileInput("inputNSH", "NSH file: ", ".nsh", function(){
              var reader = new FileReader();
              reader.onload = function() {
                  var arrayBuffer = this.result, array = new Uint8Array(arrayBuffer);
                  rnd_data.load_SHPN(array);
                  load_new_3d_object(rnd_data);
              }
              reader.readAsArrayBuffer(this.files[0]);
            })
        }
    }
}

document.getElementById('inputRND').addEventListener('change', function() {
    var reader = new FileReader();
    reader.onload = function() {
        var arrayBuffer = this.result, array = new Uint8Array(arrayBuffer);
        rnd_data = new RND(array)
        updateInfo()
    }
    reader.readAsArrayBuffer(this.files[0]);
}, false);

</script>
</body>
</html>